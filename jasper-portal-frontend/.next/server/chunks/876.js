"use strict";exports.id=876,exports.ids=[876],exports.modules={9734:(e,s,a)=>{a.d(s,{Z:()=>t});let t=(0,a(2881).Z)("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},9436:(e,s,a)=>{a.d(s,{Z:()=>t});let t=(0,a(2881).Z)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},9213:(e,s,a)=>{a.d(s,{p:()=>N});var t=a(326),r=a(7577),l=a(617),n=a(4019),c=a(7506),d=a(9734),i=a(1890),m=a(9635),x=a(2881);let o=(0,x.Z)("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);var p=a(2933);let h=(0,x.Z)("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);var j=a(9436),u=a(2017),f=a(1223),y=a(8853);function N({companyId:e,companyName:s,projectId:a,onClose:x}){let{user:N}=(0,y.a)(),[b,g]=(0,r.useState)([]),[v,w]=(0,r.useState)(null),[_,k]=(0,r.useState)([]),[Z,S]=(0,r.useState)(!0),[M,C]=(0,r.useState)(!1),[D,q]=(0,r.useState)(""),[L,T]=(0,r.useState)(""),[z,R]=(0,r.useState)(null),U=(0,r.useRef)(null),F=async(e,s)=>{S(!0);try{let a=await u.Mp.getCompanyMessages(e,s);k(a.messages.reverse())}catch(e){console.error("Failed to fetch messages:",e)}finally{S(!1)}},H=e=>{w(e),F(e.company_id,e.project_id||void 0)},K=async()=>{if(D.trim()&&v){C(!0);try{let e=N?`${N.first_name} ${N.last_name}`:"Admin",s=N?.id||1,a={company_id:v.company_id,project_id:v.project_id||void 0,content:D.trim(),subject:L.trim()||void 0,parent_id:z?.id},t=await u.Mp.send(a,e,s);k(e=>[...e,t]),q(""),T(""),R(null)}catch(e){console.error("Failed to send message:",e)}finally{C(!1)}}},Y=e=>{let s=new Date(e),a=Math.floor((new Date().getTime()-s.getTime())/864e5);return 0===a?s.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):1===a?"Yesterday":a<7?s.toLocaleDateString("en-US",{weekday:"short"}):s.toLocaleDateString("en-US",{month:"short",day:"numeric"})};return v||e?(0,t.jsxs)("div",{className:"h-full flex flex-col bg-white rounded-lg shadow-sm border border-border overflow-hidden",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-border flex items-center gap-3",children:[!e&&t.jsx("button",{onClick:()=>{w(null),k([]),q(""),T(""),R(null)},className:"p-1 hover:bg-surface-secondary rounded",children:t.jsx(i.Z,{className:"w-5 h-5 text-jasper-slate"})}),t.jsx("div",{className:"w-10 h-10 rounded-full bg-jasper-emerald/10 flex items-center justify-center",children:t.jsx(d.Z,{className:"w-5 h-5 text-jasper-emerald"})}),(0,t.jsxs)("div",{className:"flex-1",children:[t.jsx("h2",{className:"font-semibold text-jasper-carbon",children:v?.company_name}),(0,t.jsxs)("p",{className:"text-xs text-jasper-slate",children:[_.length," message",1!==_.length?"s":""]})]}),x&&t.jsx("button",{onClick:x,className:"p-1 hover:bg-surface-secondary rounded",children:t.jsx(n.Z,{className:"w-5 h-5 text-jasper-slate"})})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[Z?t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsx(c.Z,{className:"w-6 h-6 text-jasper-emerald animate-spin"})}):0===_.length?(0,t.jsxs)("div",{className:"text-center py-8 text-jasper-slate",children:[t.jsx(l.Z,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),t.jsx("p",{children:"No messages yet"}),t.jsx("p",{className:"text-sm mt-1",children:"Send the first message below"})]}):_.map(e=>(0,t.jsxs)("div",{className:(0,f.cn)("flex gap-3","admin"===e.sender_type?"flex-row-reverse":""),children:[t.jsx("div",{className:(0,f.cn)("w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0","admin"===e.sender_type?"bg-jasper-emerald text-white":"bg-surface-secondary text-jasper-slate"),children:"admin"===e.sender_type?t.jsx(m.Z,{className:"w-4 h-4"}):t.jsx(d.Z,{className:"w-4 h-4"})}),(0,t.jsxs)("div",{className:(0,f.cn)("max-w-[70%] rounded-lg p-3","admin"===e.sender_type?"bg-jasper-emerald text-white":"bg-surface-secondary text-jasper-carbon"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("span",{className:"text-xs font-medium opacity-80",children:e.sender_name}),t.jsx("span",{className:"text-xs opacity-60",children:Y(e.created_at)})]}),e.subject&&t.jsx("p",{className:"font-medium text-sm mb-1",children:e.subject}),t.jsx("p",{className:"text-sm whitespace-pre-wrap",children:e.content}),"admin"===e.sender_type&&t.jsx("div",{className:"flex items-center justify-end gap-1 mt-1 text-xs opacity-60",children:e.is_read?t.jsx(o,{className:"w-3 h-3"}):t.jsx(p.Z,{className:"w-3 h-3"})})]})]},e.id)),t.jsx("div",{ref:U})]}),z&&(0,t.jsxs)("div",{className:"px-4 py-2 bg-surface-secondary border-t border-border flex items-center gap-2",children:[t.jsx(h,{className:"w-4 h-4 text-jasper-slate"}),(0,t.jsxs)("span",{className:"text-sm text-jasper-slate truncate flex-1",children:["Replying to: ",z.content.substring(0,50),"..."]}),t.jsx("button",{onClick:()=>R(null),className:"p-1 hover:bg-surface-tertiary rounded",children:t.jsx(n.Z,{className:"w-4 h-4 text-jasper-slate"})})]}),(0,t.jsxs)("div",{className:"p-4 border-t border-border space-y-2",children:[t.jsx("input",{type:"text",value:L,onChange:e=>T(e.target.value),placeholder:"Subject (optional)",className:"input w-full text-sm"}),(0,t.jsxs)("div",{className:"flex items-end gap-2",children:[t.jsx("textarea",{value:D,onChange:e=>q(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),K())},placeholder:"Type a message...",rows:2,className:"input flex-1 resize-none"}),t.jsx("button",{onClick:K,disabled:!D.trim()||M,className:"btn-primary p-3 disabled:opacity-50",children:M?t.jsx(c.Z,{className:"w-5 h-5 animate-spin"}):t.jsx(j.Z,{className:"w-5 h-5"})})]})]})]}):(0,t.jsxs)("div",{className:"h-full flex flex-col bg-white rounded-lg shadow-sm border border-border overflow-hidden",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-border flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx(l.Z,{className:"w-5 h-5 text-jasper-emerald"}),t.jsx("h2",{className:"font-semibold text-jasper-carbon",children:"Messages"})]}),x&&t.jsx("button",{onClick:x,className:"p-1 hover:bg-surface-secondary rounded",children:t.jsx(n.Z,{className:"w-5 h-5 text-jasper-slate"})})]}),t.jsx("div",{className:"flex-1 overflow-y-auto",children:Z?t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsx(c.Z,{className:"w-6 h-6 text-jasper-emerald animate-spin"})}):0===b.length?(0,t.jsxs)("div",{className:"p-8 text-center text-jasper-slate",children:[t.jsx(l.Z,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),t.jsx("p",{children:"No conversations yet"})]}):b.map(e=>t.jsx("button",{onClick:()=>H(e),className:"w-full p-4 border-b border-border hover:bg-surface-secondary transition-colors text-left",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-jasper-emerald/10 flex items-center justify-center flex-shrink-0",children:t.jsx(d.Z,{className:"w-5 h-5 text-jasper-emerald"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"font-medium text-jasper-carbon truncate",children:e.company_name}),e.last_message&&t.jsx("span",{className:"text-xs text-jasper-slate",children:Y(e.last_message.created_at)})]}),e.last_message&&(0,t.jsxs)("p",{className:"text-sm text-jasper-slate truncate mt-1",children:["admin"===e.last_message.sender_type&&"You: ",e.last_message.content]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,t.jsxs)("span",{className:"text-xs text-jasper-slate",children:[e.message_count," message",1!==e.message_count?"s":""]}),e.unread_count>0&&(0,t.jsxs)("span",{className:"px-2 py-0.5 text-xs font-medium bg-jasper-emerald text-white rounded-full",children:[e.unread_count," new"]})]})]})]})},e.company_id))})]})}}};