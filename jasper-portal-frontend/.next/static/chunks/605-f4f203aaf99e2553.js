"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[605],{1605:function(e,t,s){s.d(t,{h4:function(){return O}}),s(9399);var a=s(7437),r=s(2369),n=s(2265),i=s(9376),l=s(5252),c=s(2051),o=s(5805),d=s(3417),m=s(6865),p=s(3245),u=s(4766),x=s(1671),h=s(1817),f=s(401),j=s(2489),b=s(3448);let g="http://127.0.0.1:8000";async function v(){try{let e=await fetch("".concat(g,"/api/v1/notifications"),{method:"GET",headers:{"Content-Type":"application/json","X-User-Id":"admin"}});if(!e.ok)throw Error("Failed to fetch notifications");let t=await e.json();if(t.success&&t.notifications)return t.notifications.map(e=>({...e,timestamp:new Date(e.timestamp)}));return[]}catch(e){return console.error("Error fetching notifications:",e),[]}}async function y(e){try{return(await fetch("".concat(g,"/api/v1/notifications"),{method:"PATCH",headers:{"Content-Type":"application/json","X-User-Id":"admin"},body:JSON.stringify({action:"mark-read",notificationId:e})})).ok}catch(e){return console.error("Error marking notification read:",e),!1}}async function N(){try{return(await fetch("".concat(g,"/api/v1/notifications"),{method:"PATCH",headers:{"Content-Type":"application/json","X-User-Id":"admin"},body:JSON.stringify({action:"mark-all-read"})})).ok}catch(e){return console.error("Error marking all notifications read:",e),!1}}async function w(e){try{return(await fetch("".concat(g,"/api/v1/notifications"),{method:"DELETE",headers:{"Content-Type":"application/json","X-User-Id":"admin"},body:JSON.stringify({notificationId:e})})).ok}catch(e){return console.error("Error deleting notification:",e),!1}}async function k(){try{return(await fetch("".concat(g,"/api/v1/notifications"),{method:"DELETE",headers:{"Content-Type":"application/json","X-User-Id":"admin"},body:JSON.stringify({clearAll:!0})})).ok}catch(e){return console.error("Error clearing notifications:",e),!1}}let E=e=>{switch(e){case"invoice":return l.Z;case"project":return c.Z;case"client":return o.Z;case"message":return d.Z;case"alert":return m.Z;default:return p.Z}},Z=(e,t)=>{if("high"===t)return"text-red-500 bg-red-50";switch(e){case"invoice":return"text-green-600 bg-green-50";case"project":return"text-blue-600 bg-blue-50";case"client":return"text-purple-600 bg-purple-50";case"message":return"text-jasper-emerald bg-jasper-emerald/10";case"alert":return"text-amber-600 bg-amber-50";default:return"text-jasper-slate bg-surface-secondary"}},C=e=>{let t=new Date().getTime()-e.getTime(),s=Math.floor(t/6e4),a=Math.floor(t/36e5),r=Math.floor(t/864e5);return s<1?"Just now":s<60?"".concat(s,"m ago"):a<24?"".concat(a,"h ago"):r<7?"".concat(r,"d ago"):(0,b.p6)(e.toISOString())};function L(){let[e,t]=(0,n.useState)(!1),[s,r]=(0,n.useState)([]),[l,c]=(0,n.useState)(!0),o=(0,n.useRef)(null),d=(0,i.useRouter)(),m=(0,n.useCallback)(async()=>{c(!0),r(await v()),c(!1)},[]);(0,n.useEffect)(()=>{m();let e=setInterval(m,3e4);return()=>clearInterval(e)},[m]),(0,n.useEffect)(()=>{let s=e=>{o.current&&!o.current.contains(e.target)&&t(!1)},a=e=>{"Escape"===e.key&&t(!1)};return e&&(document.addEventListener("mousedown",s),document.addEventListener("keydown",a)),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("keydown",a)}},[e]);let p=s.filter(e=>!e.isRead).length,g=async e=>{r(t=>t.map(t=>t.id===e?{...t,isRead:!0}:t)),y(e)},L=async()=>{r(e=>e.map(e=>({...e,isRead:!0}))),N()},D=async e=>{r(t=>t.filter(t=>t.id!==e)),w(e)},S=async()=>{r([]),t(!1),k()},R=(0,n.useCallback)(e=>{g(e.id),e.link&&d.push(e.link),t(!1)},[d]);return(0,a.jsxs)("div",{className:"relative",ref:o,children:[(0,a.jsxs)("button",{onClick:()=>t(!e),"aria-label":"Notifications".concat(p>0?" (".concat(p," unread)"):""),"aria-expanded":e,"aria-haspopup":"true",className:(0,b.cn)("relative p-2 rounded-lg transition-colors",e?"bg-jasper-emerald/10 text-jasper-emerald":"text-jasper-slate hover:bg-surface-secondary"),children:[(0,a.jsx)(u.Z,{className:"w-5 h-5","aria-hidden":"true"}),p>0&&(0,a.jsx)("span",{className:"absolute -top-0.5 -right-0.5 w-5 h-5 bg-jasper-emerald text-white text-xs font-medium rounded-full flex items-center justify-center","aria-hidden":"true",children:p>9?"9+":p})]}),e&&(0,a.jsxs)("div",{role:"menu","aria-label":"Notifications menu",className:"absolute right-0 mt-2 w-96 bg-surface-primary rounded-lg shadow-lg border border-border z-50",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("h3",{className:"font-semibold text-jasper-carbon",children:"Notifications"}),p>0&&(0,a.jsxs)("span",{className:"px-2 py-0.5 text-xs font-medium bg-jasper-emerald/10 text-jasper-emerald rounded-full",children:[p," new"]})]}),p>0&&(0,a.jsxs)("button",{onClick:L,className:"text-xs text-jasper-emerald hover:text-jasper-emerald-dark transition-colors flex items-center gap-1",children:[(0,a.jsx)(x.Z,{className:"w-3 h-3"}),"Mark all read"]})]}),(0,a.jsx)("div",{className:"max-h-96 overflow-y-auto",children:l?(0,a.jsxs)("div",{className:"p-8 text-center text-jasper-slate",children:[(0,a.jsx)(h.Z,{className:"w-8 h-8 mx-auto mb-2 animate-spin opacity-50"}),(0,a.jsx)("p",{className:"text-sm",children:"Loading notifications..."})]}):0===s.length?(0,a.jsxs)("div",{className:"p-8 text-center text-jasper-slate",children:[(0,a.jsx)(u.Z,{className:"w-10 h-10 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{className:"text-sm",children:"No notifications yet"})]}):(0,a.jsx)("div",{className:"divide-y divide-border",children:s.map(e=>{let t=E(e.type),s=Z(e.type,e.priority);return(0,a.jsxs)("div",{role:"menuitem",tabIndex:0,"aria-label":"".concat(e.title,": ").concat(e.message).concat(e.isRead?"":" (unread)"),className:(0,b.cn)("relative p-4 hover:bg-surface-secondary transition-colors cursor-pointer group","focus:outline-none focus:ring-2 focus:ring-jasper-emerald focus:ring-inset",!e.isRead&&"bg-jasper-emerald/5"),onClick:()=>R(e),onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),R(e))},children:[(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("div",{className:(0,b.cn)("w-9 h-9 rounded-lg flex items-center justify-center flex-shrink-0",s),children:(0,a.jsx)(t,{className:"w-4 h-4"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,a.jsx)("p",{className:(0,b.cn)("text-sm font-medium",e.isRead?"text-jasper-slate":"text-jasper-carbon"),children:e.title}),(0,a.jsx)("span",{className:"text-xs text-jasper-slate-light whitespace-nowrap flex-shrink-0",children:C(e.timestamp)})]}),(0,a.jsx)("p",{className:"text-sm text-jasper-slate mt-0.5 line-clamp-2",children:e.message})]}),!e.isRead&&(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-jasper-emerald flex-shrink-0 mt-2"})]}),(0,a.jsxs)("div",{className:"absolute right-2 top-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1",children:[!e.isRead&&(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),g(e.id)},className:"p-1.5 hover:bg-surface-tertiary rounded-md transition-colors",title:"Mark as read",children:(0,a.jsx)(f.Z,{className:"w-3.5 h-3.5 text-jasper-slate"})}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),D(e.id)},className:"p-1.5 hover:bg-red-50 rounded-md transition-colors",title:"Delete",children:(0,a.jsx)(j.Z,{className:"w-3.5 h-3.5 text-jasper-slate hover:text-red-500"})})]})]},e.id)})})}),s.length>0&&(0,a.jsx)("div",{className:"border-t border-border p-3",children:(0,a.jsx)("button",{onClick:S,className:"w-full text-sm text-jasper-slate hover:text-jasper-carbon transition-colors text-center",children:"Clear all notifications"})})]})]})}var D=s(4938),S=s(8736),R=s(8728),T=s(3247),I=s(3315),q=s(6858),_=s(6764);let K=[{id:"dashboard",title:"Dashboard",type:"page",href:"/",icon:D.Z},{id:"clients",title:"Clients",subtitle:"View all clients",type:"page",href:"/clients",icon:o.Z},{id:"projects",title:"Projects",subtitle:"View all projects",type:"page",href:"/projects",icon:c.Z},{id:"invoices",title:"Invoices",subtitle:"View all invoices",type:"page",href:"/invoices",icon:S.Z},{id:"settings",title:"Settings",subtitle:"Account preferences",type:"page",href:"/settings",icon:R.Z}],M={client:o.Z,project:c.Z,invoice:S.Z,page:D.Z},A={client:"bg-blue-100 text-blue-600",project:"bg-jasper-emerald/10 text-jasper-emerald",invoice:"bg-purple-100 text-purple-600",page:"bg-jasper-slate/10 text-jasper-slate"};function J(e){let{className:t}=e,[s,r]=(0,n.useState)(!1),[l,d]=(0,n.useState)(""),[m,p]=(0,n.useState)(0),u=(0,n.useRef)(null),x=(0,i.useRouter)(),{data:f,isLoading:g}=(0,_.JE)({page:1,page_size:100}),{data:v,isLoading:y}=(0,_.Z0)({page:1,page_size:100}),{data:N,isLoading:w}=(0,_.qx)({page:1,page_size:100}),k=(()=>{if(!l.trim())return K;let e=[],t=l.toLowerCase();return((null==f?void 0:f.companies)||[]).filter(e=>{var s;return e.name.toLowerCase().includes(t)||(null===(s=e.email)||void 0===s?void 0:s.toLowerCase().includes(t))}).slice(0,3).forEach(t=>{e.push({id:"client-".concat(t.id),title:t.name,subtitle:t.email||t.country,type:"client",href:"/clients/".concat(t.id),icon:o.Z})}),((null==v?void 0:v.projects)||[]).filter(e=>{var s;return e.name.toLowerCase().includes(t)||(null===(s=e.reference)||void 0===s?void 0:s.toLowerCase().includes(t))}).slice(0,3).forEach(t=>{e.push({id:"project-".concat(t.id),title:t.name,subtitle:t.reference,type:"project",href:"/projects/".concat(t.id),icon:c.Z})}),((null==N?void 0:N.invoices)||[]).filter(e=>{var s;return null===(s=e.invoice_number)||void 0===s?void 0:s.toLowerCase().includes(t)}).slice(0,3).forEach(t=>{e.push({id:"invoice-".concat(t.id),title:t.invoice_number,subtitle:"".concat(t.status," - ").concat(t.currency," ").concat(t.total),type:"invoice",href:"/invoices/".concat(t.id),icon:S.Z})}),K.filter(e=>{var s;return e.title.toLowerCase().includes(t)||(null===(s=e.subtitle)||void 0===s?void 0:s.toLowerCase().includes(t))}).forEach(t=>e.push(t)),e})();(0,n.useEffect)(()=>{let e=e=>{(e.metaKey||e.ctrlKey)&&"k"===e.key&&(e.preventDefault(),r(!0)),"Escape"===e.key&&s&&r(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[s]),(0,n.useEffect)(()=>{if(s){var e;null===(e=u.current)||void 0===e||e.focus(),d(""),p(0)}},[s]);let E=e=>{x.push(e.href),r(!1)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:()=>r(!0),className:(0,b.cn)("flex items-center gap-2 px-3 py-2 text-sm text-jasper-slate rounded-lg","bg-surface-secondary hover:bg-surface-tertiary border border-border","transition-colors duration-200",t),children:[(0,a.jsx)(T.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Search..."}),(0,a.jsxs)("kbd",{className:"hidden sm:inline-flex items-center gap-1 px-1.5 py-0.5 text-xs font-mono bg-surface-tertiary rounded border border-border-light",children:[(0,a.jsx)(I.Z,{className:"w-3 h-3"}),"K"]})]}),s&&(0,a.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>r(!1)}),(0,a.jsx)("div",{className:"relative flex items-start justify-center pt-[15vh] px-4",children:(0,a.jsxs)("div",{className:"w-full max-w-xl bg-surface-primary rounded-xl shadow-modal overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 px-4 py-3 border-b border-border",children:[(0,a.jsx)(T.Z,{className:"w-5 h-5 text-jasper-slate flex-shrink-0"}),(0,a.jsx)("input",{ref:u,type:"text",value:l,onChange:e=>{d(e.target.value),p(0)},onKeyDown:e=>{switch(e.key){case"ArrowDown":e.preventDefault(),p(e=>Math.min(e+1,k.length-1));break;case"ArrowUp":e.preventDefault(),p(e=>Math.max(e-1,0));break;case"Enter":e.preventDefault(),k[m]&&(x.push(k[m].href),r(!1))}},placeholder:"Search clients, projects, invoices...",className:"flex-1 bg-transparent text-jasper-carbon placeholder:text-jasper-slate-light focus:outline-none text-base"}),l&&(0,a.jsx)("button",{onClick:()=>d(""),className:"p-1 hover:bg-surface-secondary rounded",children:(0,a.jsx)(j.Z,{className:"w-4 h-4 text-jasper-slate"})})]}),(0,a.jsx)("div",{className:"max-h-[50vh] overflow-y-auto",children:(g||y||w)&&l?(0,a.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,a.jsx)(h.Z,{className:"w-5 h-5 animate-spin text-jasper-slate"})}):0===k.length?(0,a.jsx)("div",{className:"py-8 text-center",children:(0,a.jsxs)("p",{className:"text-jasper-slate",children:['No results found for "',l,'"']})}):(0,a.jsxs)("div",{className:"py-2",children:[!l&&(0,a.jsx)("div",{className:"px-4 py-2 text-xs font-medium text-jasper-slate-light uppercase tracking-wider",children:"Quick Links"}),k.map((e,t)=>{let s=e.icon||M[e.type],r=A[e.type];return(0,a.jsxs)("button",{onClick:()=>E(e),onMouseEnter:()=>p(t),className:(0,b.cn)("w-full flex items-center gap-3 px-4 py-3 text-left transition-colors",m===t?"bg-jasper-emerald/5":"hover:bg-surface-secondary"),children:[(0,a.jsx)("div",{className:(0,b.cn)("w-9 h-9 rounded-lg flex items-center justify-center flex-shrink-0",r),children:(0,a.jsx)(s,{className:"w-4 h-4"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"font-medium text-jasper-carbon truncate",children:e.title}),e.subtitle&&(0,a.jsx)("div",{className:"text-sm text-jasper-slate truncate",children:e.subtitle})]}),m===t&&(0,a.jsx)(q.Z,{className:"w-4 h-4 text-jasper-emerald flex-shrink-0"})]},e.id)})]})}),(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 border-t border-border bg-surface-secondary text-xs text-jasper-slate",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)("kbd",{className:"px-1.5 py-0.5 bg-surface-tertiary rounded",children:"↑"}),(0,a.jsx)("kbd",{className:"px-1.5 py-0.5 bg-surface-tertiary rounded",children:"↓"}),"to navigate"]}),(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)("kbd",{className:"px-1.5 py-0.5 bg-surface-tertiary rounded",children:"↵"}),"to select"]})]}),(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)("kbd",{className:"px-1.5 py-0.5 bg-surface-tertiary rounded",children:"esc"}),"to close"]})]})]})})]})]})}var z=s(7648),U=s(407);function F(e){let{items:t,className:s,showHome:r=!0}=e,n=r?[{label:"Dashboard",href:"/",icon:(0,a.jsx)(D.Z,{className:"w-4 h-4"})},...t]:t;return(0,a.jsx)("nav",{className:(0,b.cn)("flex items-center",s),"aria-label":"Breadcrumb",children:(0,a.jsx)("ol",{className:"flex items-center gap-1 text-sm",children:n.map((e,t)=>{let s=t===n.length-1,r=0===t;return(0,a.jsxs)("li",{className:"flex items-center gap-1",children:[!r&&(0,a.jsx)(U.Z,{className:"w-4 h-4 text-jasper-slate-light flex-shrink-0"}),s?(0,a.jsxs)("span",{className:"font-medium text-jasper-carbon truncate max-w-[200px]","aria-current":"page",children:[e.icon&&(0,a.jsx)("span",{className:"mr-1.5 inline-flex",children:e.icon}),e.label]}):e.href?(0,a.jsxs)(z.default,{href:e.href,className:"flex items-center gap-1.5 text-jasper-slate hover:text-jasper-emerald transition-colors",children:[e.icon,(0,a.jsx)("span",{className:(0,b.cn)(r&&!e.icon?"":"hidden sm:inline"),children:e.label})]}):(0,a.jsxs)("span",{className:"flex items-center gap-1.5 text-jasper-slate",children:[e.icon,(0,a.jsx)("span",{children:e.label})]})]},t)})})})}function O(e){let{title:t,subtitle:s,breadcrumbs:n}=e;return(0,a.jsx)("header",{className:"sticky top-0 z-30 bg-white border-b border-border",children:(0,a.jsxs)("div",{className:"flex items-center justify-between h-16 px-6",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[n&&n.length>0&&(0,a.jsx)(F,{items:n,className:"mb-1"}),t&&(0,a.jsx)("h1",{className:"text-xl font-semibold text-jasper-carbon",children:t}),s&&(0,a.jsx)("p",{className:"text-sm text-jasper-slate",children:s})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(J,{className:"hidden md:flex"}),(0,a.jsx)(L,{}),(0,a.jsxs)("button",{className:"flex items-center gap-3 p-2 hover:bg-surface-secondary rounded-lg transition-colors",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-jasper-emerald/10 flex items-center justify-center",children:(0,a.jsx)(r.Z,{className:"w-4 h-4 text-jasper-emerald"})}),(0,a.jsxs)("div",{className:"hidden md:flex flex-col items-start",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-jasper-carbon",children:"Admin"}),(0,a.jsx)("span",{className:"text-xs text-jasper-slate",children:"admin@jasper.com"})]})]})]})]})})}s(5213)},6764:function(e,t,s){s.d(t,{JE:function(){return i},Z0:function(){return l},qx:function(){return c}});var a=s(1713),r=s(5359);let n={companies:{all:["companies"],lists:()=>[...n.companies.all,"list"],list:e=>[...n.companies.lists(),e],details:()=>[...n.companies.all,"detail"],detail:e=>[...n.companies.details(),e]},projects:{all:["projects"],lists:()=>[...n.projects.all,"list"],list:e=>[...n.projects.lists(),e],details:()=>[...n.projects.all,"detail"],detail:e=>[...n.projects.details(),e],milestones:e=>[...n.projects.all,"milestones",e],timeline:e=>[...n.projects.all,"timeline",e]},invoices:{all:["invoices"],lists:()=>[...n.invoices.all,"list"],list:e=>[...n.invoices.lists(),e],details:()=>[...n.invoices.all,"detail"],detail:e=>[...n.invoices.details(),e]},dashboard:{all:["dashboard"],metrics:()=>[...n.dashboard.all,"metrics"],analytics:()=>[...n.dashboard.all,"analytics"]}};function i(e){return(0,a.a)({queryKey:n.companies.list(e),queryFn:()=>r.cv.list(e)})}function l(e){return(0,a.a)({queryKey:n.projects.list(e),queryFn:()=>r.qx.list(e)})}function c(e){return(0,a.a)({queryKey:n.invoices.list(e),queryFn:()=>r.iR.list(e)})}}}]);