"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[597],{8420:function(e,s,a){a.d(s,{Z:function(){return t}});let t=(0,a(9205).Z)("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},4743:function(e,s,a){a.d(s,{Z:function(){return t}});let t=(0,a(9205).Z)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},9597:function(e,s,a){a.d(s,{p:function(){return b}});var t=a(7437),l=a(2265),r=a(3417),n=a(2489),c=a(1817),d=a(8420),i=a(2451),m=a(2369),o=a(9205);let x=(0,o.Z)("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);var h=a(401);let p=(0,o.Z)("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);var u=a(4743),j=a(5359),f=a(3448),y=a(7766);function b(e){let{companyId:s,companyName:a,projectId:o,onClose:b}=e,{user:N}=(0,y.a)(),[g,v]=(0,l.useState)([]),[w,_]=(0,l.useState)(null),[k,Z]=(0,l.useState)([]),[S,M]=(0,l.useState)(!0),[C,D]=(0,l.useState)(!1),[E,T]=(0,l.useState)(""),[q,L]=(0,l.useState)(""),[z,F]=(0,l.useState)(null),R=(0,l.useRef)(null);(0,l.useEffect)(()=>{s?(_({company_id:s,company_name:a||"Client",project_id:o||null,project_name:null,last_message:null,message_count:0,unread_count:0}),H(s,o)):U()},[s,o]),(0,l.useEffect)(()=>{var e;null===(e=R.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[k]);let U=async()=>{M(!0);try{let e=await j.Mp.getThreads();v(e.threads)}catch(e){console.error("Failed to fetch threads:",e)}finally{M(!1)}},H=async(e,s)=>{M(!0);try{let a=await j.Mp.getCompanyMessages(e,s);Z(a.messages.reverse())}catch(e){console.error("Failed to fetch messages:",e)}finally{M(!1)}},K=e=>{_(e),H(e.company_id,e.project_id||void 0)},V=async()=>{if(E.trim()&&w){D(!0);try{let e=N?"".concat(N.first_name," ").concat(N.last_name):"Admin",s=(null==N?void 0:N.id)||1,a={company_id:w.company_id,project_id:w.project_id||void 0,content:E.trim(),subject:q.trim()||void 0,parent_id:null==z?void 0:z.id},t=await j.Mp.send(a,e,s);Z(e=>[...e,t]),T(""),L(""),F(null)}catch(e){console.error("Failed to send message:",e)}finally{D(!1)}}},Y=e=>{let s=new Date(e),a=Math.floor((new Date().getTime()-s.getTime())/864e5);return 0===a?s.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):1===a?"Yesterday":a<7?s.toLocaleDateString("en-US",{weekday:"short"}):s.toLocaleDateString("en-US",{month:"short",day:"numeric"})};return w||s?(0,t.jsxs)("div",{className:"h-full flex flex-col bg-white rounded-lg shadow-sm border border-border overflow-hidden",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-border flex items-center gap-3",children:[!s&&(0,t.jsx)("button",{onClick:()=>{_(null),Z([]),T(""),L(""),F(null)},className:"p-1 hover:bg-surface-secondary rounded",children:(0,t.jsx)(i.Z,{className:"w-5 h-5 text-jasper-slate"})}),(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-jasper-emerald/10 flex items-center justify-center",children:(0,t.jsx)(d.Z,{className:"w-5 h-5 text-jasper-emerald"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h2",{className:"font-semibold text-jasper-carbon",children:null==w?void 0:w.company_name}),(0,t.jsxs)("p",{className:"text-xs text-jasper-slate",children:[k.length," message",1!==k.length?"s":""]})]}),b&&(0,t.jsx)("button",{onClick:b,className:"p-1 hover:bg-surface-secondary rounded",children:(0,t.jsx)(n.Z,{className:"w-5 h-5 text-jasper-slate"})})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[S?(0,t.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,t.jsx)(c.Z,{className:"w-6 h-6 text-jasper-emerald animate-spin"})}):0===k.length?(0,t.jsxs)("div",{className:"text-center py-8 text-jasper-slate",children:[(0,t.jsx)(r.Z,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),(0,t.jsx)("p",{children:"No messages yet"}),(0,t.jsx)("p",{className:"text-sm mt-1",children:"Send the first message below"})]}):k.map(e=>(0,t.jsxs)("div",{className:(0,f.cn)("flex gap-3","admin"===e.sender_type?"flex-row-reverse":""),children:[(0,t.jsx)("div",{className:(0,f.cn)("w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0","admin"===e.sender_type?"bg-jasper-emerald text-white":"bg-surface-secondary text-jasper-slate"),children:"admin"===e.sender_type?(0,t.jsx)(m.Z,{className:"w-4 h-4"}):(0,t.jsx)(d.Z,{className:"w-4 h-4"})}),(0,t.jsxs)("div",{className:(0,f.cn)("max-w-[70%] rounded-lg p-3","admin"===e.sender_type?"bg-jasper-emerald text-white":"bg-surface-secondary text-jasper-carbon"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("span",{className:"text-xs font-medium opacity-80",children:e.sender_name}),(0,t.jsx)("span",{className:"text-xs opacity-60",children:Y(e.created_at)})]}),e.subject&&(0,t.jsx)("p",{className:"font-medium text-sm mb-1",children:e.subject}),(0,t.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:e.content}),"admin"===e.sender_type&&(0,t.jsx)("div",{className:"flex items-center justify-end gap-1 mt-1 text-xs opacity-60",children:e.is_read?(0,t.jsx)(x,{className:"w-3 h-3"}):(0,t.jsx)(h.Z,{className:"w-3 h-3"})})]})]},e.id)),(0,t.jsx)("div",{ref:R})]}),z&&(0,t.jsxs)("div",{className:"px-4 py-2 bg-surface-secondary border-t border-border flex items-center gap-2",children:[(0,t.jsx)(p,{className:"w-4 h-4 text-jasper-slate"}),(0,t.jsxs)("span",{className:"text-sm text-jasper-slate truncate flex-1",children:["Replying to: ",z.content.substring(0,50),"..."]}),(0,t.jsx)("button",{onClick:()=>F(null),className:"p-1 hover:bg-surface-tertiary rounded",children:(0,t.jsx)(n.Z,{className:"w-4 h-4 text-jasper-slate"})})]}),(0,t.jsxs)("div",{className:"p-4 border-t border-border space-y-2",children:[(0,t.jsx)("input",{type:"text",value:q,onChange:e=>L(e.target.value),placeholder:"Subject (optional)",className:"input w-full text-sm"}),(0,t.jsxs)("div",{className:"flex items-end gap-2",children:[(0,t.jsx)("textarea",{value:E,onChange:e=>T(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),V())},placeholder:"Type a message...",rows:2,className:"input flex-1 resize-none"}),(0,t.jsx)("button",{onClick:V,disabled:!E.trim()||C,className:"btn-primary p-3 disabled:opacity-50",children:C?(0,t.jsx)(c.Z,{className:"w-5 h-5 animate-spin"}):(0,t.jsx)(u.Z,{className:"w-5 h-5"})})]})]})]}):(0,t.jsxs)("div",{className:"h-full flex flex-col bg-white rounded-lg shadow-sm border border-border overflow-hidden",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-border flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(r.Z,{className:"w-5 h-5 text-jasper-emerald"}),(0,t.jsx)("h2",{className:"font-semibold text-jasper-carbon",children:"Messages"})]}),b&&(0,t.jsx)("button",{onClick:b,className:"p-1 hover:bg-surface-secondary rounded",children:(0,t.jsx)(n.Z,{className:"w-5 h-5 text-jasper-slate"})})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto",children:S?(0,t.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,t.jsx)(c.Z,{className:"w-6 h-6 text-jasper-emerald animate-spin"})}):0===g.length?(0,t.jsxs)("div",{className:"p-8 text-center text-jasper-slate",children:[(0,t.jsx)(r.Z,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),(0,t.jsx)("p",{children:"No conversations yet"})]}):g.map(e=>(0,t.jsx)("button",{onClick:()=>K(e),className:"w-full p-4 border-b border-border hover:bg-surface-secondary transition-colors text-left",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-jasper-emerald/10 flex items-center justify-center flex-shrink-0",children:(0,t.jsx)(d.Z,{className:"w-5 h-5 text-jasper-emerald"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"font-medium text-jasper-carbon truncate",children:e.company_name}),e.last_message&&(0,t.jsx)("span",{className:"text-xs text-jasper-slate",children:Y(e.last_message.created_at)})]}),e.last_message&&(0,t.jsxs)("p",{className:"text-sm text-jasper-slate truncate mt-1",children:["admin"===e.last_message.sender_type&&"You: ",e.last_message.content]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,t.jsxs)("span",{className:"text-xs text-jasper-slate",children:[e.message_count," message",1!==e.message_count?"s":""]}),e.unread_count>0&&(0,t.jsxs)("span",{className:"px-2 py-0.5 text-xs font-medium bg-jasper-emerald text-white rounded-full",children:[e.unread_count," new"]})]})]})]})},e.company_id))})]})}}}]);